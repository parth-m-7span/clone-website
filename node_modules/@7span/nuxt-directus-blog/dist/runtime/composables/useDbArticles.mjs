import { useRuntimeConfig } from "#imports";

export const useDbArticles = (
  params = { limit: 10, filter: {}, fields: [], page: 1 }
) => {
  const {
    public: {
      blog: { baseUrl, collection, productId },
    },
  } = useRuntimeConfig();

  params.fields = params.fields || [];

  return $fetch(`${baseUrl}/items/${collection}`, {
    params: {
      fields: [
        "id",
        "title",
        "date_created",
        "slug",
        "cover.id",
        "cover.width",
        "cover.filename_disk",
        "cover.title",
        "author.first_name",
        "author.last_name",
        "tags.bg_tags_id.label",
        "tags.bg_tags_id.slug",
        ...params.fields,
      ],
      limit: params.limit || 10,
      page: params.page || 1,
      meta: "*",
      sort: ["-date_created"],
      filter: {
        status: "published",
        product: {
          id: productId,
        },
        ...params.filter,
      },
    },
  });
};
