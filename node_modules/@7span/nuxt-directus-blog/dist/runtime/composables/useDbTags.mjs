// Auto Imports stops working once package is installed in node_modules directory. therefore importing from #imports
import { useRuntimeConfig, useAsyncData, createError } from "#imports";

export const useDbTags = async (fields = []) => {
  const {
    public: {
      blog: { baseUrl, productId },
    },
  } = useRuntimeConfig();

  const { data, error } = await useAsyncData("blog-tags", () => {
    return $fetch(`${baseUrl}/items/bg_tags`, {
      params: {
        fields: ["label", "slug", ...fields],
        limit: -1,
        filter: {
          status: "published",
          product: {
            id: productId,
          },
        },
      },
    });
  });

  if (error.value) {
    throw createError({
      statusCode: error.value.statusCode,
      statusMessage: error.value.message,
    });
  } else {
    return {
      data: data.value.data,
    };
  }
};
